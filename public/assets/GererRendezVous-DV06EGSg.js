import{c as r,e as t,m as c,j as z,v as T,H as Z,F as P,D as C,t as a,g as I,B as N,r as p,E as g,o as L,n as l}from"./app-CAn8e8WT.js";import{_ as $}from"./_plugin-vue_export-helper-DlAUqK2U.js";const tt={__name:"GererRendezVous",setup(V,{expose:o}){o();const w=p(""),e=p(!1),x=p([]),A=p(null),f=p(!1),_=p(""),b=[10,25,50],u=p(b[0]),s=p(1),k=new Date().toISOString().slice(0,10),R=n=>n.patient?`${n.patient.first_name||""} ${n.patient.last_name||""}`.trim()||"Nom inconnu":"—",E=n=>n.doctor?`${n.doctor.first_name||""} ${n.doctor.last_name||""}`.trim()||"Docteur inconnu":"—",F=n=>{var m,v;if(!n)return"?";const i=((m=n.first_name)==null?void 0:m[0])||"",d=((v=n.last_name)==null?void 0:v[0])||"";return(i+d).toUpperCase()||"?"},U=n=>{const i="inline-block px-2 py-1 text-xs rounded";switch(n){case"ANNULE":return`${i} bg-red-100 text-red-700`;case"TERMINE":return`${i} bg-green-100 text-green-700`;case"CONFIRME":return`${i} bg-blue-100 text-blue-700`;default:return`${i} bg-gray-100 text-gray-700`}};async function S(){e.value=!0;try{const n=await fetch("/appointments");if(!n.ok)throw new Error(`Erreur HTTP: ${n.status}`);const i=await n.json();x.value=i.appointments||[],console.log("Rendez-vous chargés:",x.value.length)}catch(n){console.error("Erreur chargement rendez-vous",n),x.value=[]}finally{e.value=!1}}async function j(n){if(confirm("Êtes-vous sûr de vouloir annuler ce rendez-vous ?"))try{if(!(await fetch(`/appointments/cancel/${n}`,{method:"PUT"})).ok)throw new Error("Erreur lors de l'annulation");await S()}catch(i){console.error("Erreur annulation",i),alert("Erreur lors de l'annulation du rendez-vous")}}const D=g(()=>{let n=x.value;if(_.value){const d=_.value;n=n.filter(m=>m.dateDebut?(typeof m.dateDebut=="string"?m.dateDebut:m.dateDebut.toString()).split("T")[0]===d:!1)}if(!w.value)return n;const i=w.value.toLowerCase();return n.filter(d=>{const m=R(d).toLowerCase(),v=E(d).toLowerCase(),h=d.dateDebut?d.dateDebut.toString().toLowerCase():"",Y=(d.typeRdv||"").toLowerCase();return m.includes(i)||v.includes(i)||h.includes(i)||Y.includes(i)})}),y=g(()=>Math.max(1,Math.ceil(D.value.length/u.value))),B=g(()=>{s.value>y.value&&(s.value=y.value);const n=(s.value-1)*u.value;return D.value.slice(n,n+u.value)}),G=g(()=>D.value.length===0?0:(s.value-1)*u.value+1),O=g(()=>Math.min(D.value.length,s.value*u.value)),H=g(()=>{const n=[],i=y.value,d=s.value,m=Math.max(1,d-2),v=Math.min(i,d+2);for(let h=m;h<=v;h++)n.push(h);return n});function q(){s.value>1&&s.value--}function J(){s.value<y.value&&s.value++}function K(n){n>=1&&n<=y.value&&(s.value=n)}function Q(n){if(!n)return"—";try{return new Date(n).toLocaleString("fr-FR",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}catch{return"Date invalide"}}function W(n){A.value=n,f.value=!0}function X(){f.value=!1,A.value=null}L(()=>{S()});const M={search:w,loading:e,appointments:x,selectedAppointment:A,showDetails:f,selectedDate:_,pageSizes:b,pageSize:u,currentPage:s,maxDate:k,getPatientName:R,getDoctorName:E,getInitials:F,getStatusClass:U,fetchAppointments:S,cancelAppointment:j,filteredAppointments:D,totalPages:y,pagedAppointments:B,startItem:G,endItem:O,pagesToShow:H,prevPage:q,nextPage:J,goToPage:K,formatDate:Q,openDetails:W,closeDetails:X,ref:p,computed:g,onMounted:L};return Object.defineProperty(M,"__isScriptSetup",{enumerable:!1,value:!0}),M}},et={class:"flex justify-between items-center mb-6"},st={class:"flex items-center gap-4"},nt=["max"],ot=["value"],at={class:"bg-white shadow rounded overflow-x-auto"},it={class:"min-w-full text-left"},rt={key:0},lt={key:1},dt={class:"px-4 py-3 text-sm"},ct={class:"px-4 py-3 text-sm"},mt={class:"px-4 py-3 text-sm"},ut={class:"px-4 py-3 text-sm"},pt={class:"px-4 py-3 text-sm"},vt={class:"px-4 py-3 text-sm"},gt={class:"px-4 py-3 text-sm"},xt=["onClick"],ft=["onClick"],_t={class:"mt-4 flex items-center justify-between"},yt={class:"text-sm text-gray-600"},ht={class:"flex items-center gap-2"},bt=["disabled"],Dt=["onClick"],wt=["disabled"],At={key:0,class:"fixed inset-0 z-50 flex"},kt={class:"w-full max-w-md h-full bg-white shadow-2xl p-6 relative animate-slide-in-right overflow-y-auto"},Pt={key:0,class:"space-y-4"},Ct={class:"flex items-start gap-4"},St={class:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center text-2xl font-bold text-gray-500"},zt={class:"flex-1"},Nt={class:"text-lg font-semibold"},Rt={class:"text-sm text-gray-500"},Et={class:"text-sm text-gray-500"},Mt={class:"grid grid-cols-2 gap-4"},Tt={class:"p-3 bg-gray-50 rounded"},It={class:"font-semibold"},Lt={class:"text-sm text-gray-500"},Vt={class:"text-sm text-gray-500"},Ft={class:"p-3 bg-gray-50 rounded"},Ut={class:"mt-1 text-sm"},jt={class:"text-sm"},Bt={class:"mt-1"},Gt={class:"ml-2 inline-block px-2 py-1 text-xs rounded bg-gray-100 text-gray-700"},Ot={class:"p-3 bg-white rounded border"},Ht={class:"text-sm text-gray-700"},qt={key:0,class:"p-3 bg-white rounded border"},Jt={class:"text-sm text-gray-700 space-y-1"},Kt={key:1,class:"p-3 bg-white rounded border"},Qt={class:"text-sm text-gray-700"};function Wt(V,o,w,e,x,A){var f,_,b,u;return l(),r("div",null,[t("div",et,[o[3]||(o[3]=t("div",null,[t("h2",{class:"text-xl font-bold"},"Liste des rendez-vous"),t("p",{class:"text-sm text-gray-500"},"Tableau listant tous les rendez-vous")],-1)),t("div",st,[z(t("input",{"onUpdate:modelValue":o[0]||(o[0]=s=>e.search=s),type:"text",placeholder:"Rechercher par patient, médecin ou date",class:"px-4 py-2 border rounded-md w-80"},null,512),[[T,e.search]]),z(t("input",{"onUpdate:modelValue":o[1]||(o[1]=s=>e.selectedDate=s),type:"date",class:"px-3 py-2 border rounded-md",max:e.maxDate},null,8,nt),[[T,e.selectedDate]]),z(t("select",{"onUpdate:modelValue":o[2]||(o[2]=s=>e.pageSize=s),class:"px-3 py-2 border rounded-md"},[(l(),r(P,null,C(e.pageSizes,s=>t("option",{key:s,value:s},a(s)+" / page",9,ot)),64))],512),[[Z,e.pageSize,void 0,{number:!0}]])])]),t("div",at,[t("table",it,[o[6]||(o[6]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-4 py-2 text-sm font-medium"},"Date début"),t("th",{class:"px-4 py-2 text-sm font-medium"},"Date fin"),t("th",{class:"px-4 py-2 text-sm font-medium"},"Patient"),t("th",{class:"px-4 py-2 text-sm font-medium"},"Médecin"),t("th",{class:"px-4 py-2 text-sm font-medium"},"Type"),t("th",{class:"px-4 py-2 text-sm font-medium"},"État"),t("th",{class:"px-4 py-2 text-sm font-medium"},"Actions")])],-1)),t("tbody",null,[e.loading?(l(),r("tr",rt,[...o[4]||(o[4]=[t("td",{colspan:"7",class:"px-4 py-6 text-center"},"Chargement...",-1)])])):!e.loading&&e.filteredAppointments.length===0?(l(),r("tr",lt,[...o[5]||(o[5]=[t("td",{colspan:"7",class:"px-4 py-6 text-center"},"Aucun rendez-vous trouvé.",-1)])])):(l(!0),r(P,{key:2},C(e.pagedAppointments,s=>(l(),r("tr",{key:s.id,class:"border-t hover:bg-gray-50"},[t("td",dt,a(e.formatDate(s.dateDebut)),1),t("td",ct,a(e.formatDate(s.dateFin)),1),t("td",mt,a(e.getPatientName(s)),1),t("td",ut,a(e.getDoctorName(s)),1),t("td",pt,a(s.typeRdv),1),t("td",vt,[t("span",{class:N(e.getStatusClass(s.etatRdv))},a(s.etatRdv),3)]),t("td",gt,[t("button",{onClick:k=>e.openDetails(s),class:"text-blue-600 hover:underline mr-2"},"Détails",8,xt),s.etatRdv!=="ANNULE"&&s.etatRdv!=="TERMINE"?(l(),r("button",{key:0,onClick:k=>e.cancelAppointment(s.id),class:"text-red-600 hover:underline"}," Annuler ",8,ft)):c("v-if",!0)])]))),128))])])]),c(" Pagination "),t("div",_t,[t("div",yt," Affichage "+a(e.startItem)+" - "+a(e.endItem)+" sur "+a(e.filteredAppointments.length),1),t("div",ht,[t("button",{onClick:e.prevPage,disabled:e.currentPage===1,class:"px-3 py-1 bg-gray-100 rounded disabled:opacity-50"}," Préc ",8,bt),(l(!0),r(P,null,C(e.pagesToShow,s=>(l(),r("button",{key:s,onClick:k=>e.goToPage(s),class:N({"px-3 py-1 rounded":!0,"bg-blue-600 text-white":s===e.currentPage,"bg-gray-100":s!==e.currentPage})},a(s),11,Dt))),128)),t("button",{onClick:e.nextPage,disabled:e.currentPage===e.totalPages,class:"px-3 py-1 bg-gray-100 rounded disabled:opacity-50"}," Suiv ",8,wt)])]),c(" Panneau latéral Détails rendez-vous "),e.showDetails?(l(),r("div",At,[t("div",{class:"flex-1 bg-black bg-opacity-40",onClick:e.closeDetails}),t("div",kt,[t("button",{class:"absolute top-3 right-3 text-gray-500 hover:bg-gray-100 rounded-full p-1",onClick:e.closeDetails}," × "),o[14]||(o[14]=t("h3",{class:"text-xl font-semibold mb-4"},"Détails du rendez-vous",-1)),e.selectedAppointment?(l(),r("div",Pt,[c(" Patient "),t("div",Ct,[t("div",St,a(e.getInitials(e.selectedAppointment.patient)),1),t("div",zt,[t("div",Nt,a(e.getPatientName(e.selectedAppointment)),1),t("div",Rt,a(((f=e.selectedAppointment.patient)==null?void 0:f.email)||"—"),1),t("div",Et,a(((_=e.selectedAppointment.patient)==null?void 0:_.phone)||"—"),1)])]),c(" Médecin et Informations "),t("div",Mt,[t("div",Tt,[o[7]||(o[7]=t("div",{class:"text-xs text-gray-500"},"Médecin",-1)),t("div",It,a(e.getDoctorName(e.selectedAppointment)),1),t("div",Lt,a(((b=e.selectedAppointment.doctor)==null?void 0:b.email)||"—"),1),t("div",Vt,a(((u=e.selectedAppointment.doctor)==null?void 0:u.phone)||"—"),1)]),t("div",Ft,[o[10]||(o[10]=t("div",{class:"text-xs text-gray-500"},"Informations",-1)),t("div",Ut,[o[8]||(o[8]=t("span",{class:"font-medium"},"Début:",-1)),I(" "+a(e.formatDate(e.selectedAppointment.dateDebut)),1)]),t("div",jt,[o[9]||(o[9]=t("span",{class:"font-medium"},"Fin:",-1)),I(" "+a(e.formatDate(e.selectedAppointment.dateFin)),1)]),t("div",Bt,[t("span",{class:N(e.getStatusClass(e.selectedAppointment.etatRdv))},a(e.selectedAppointment.etatRdv),3),t("span",Gt,a(e.selectedAppointment.typeRdv),1)])])]),c(" Description "),t("div",Ot,[o[11]||(o[11]=t("div",{class:"text-sm font-medium mb-2"},"Description",-1)),t("div",Ht,a(e.selectedAppointment.description||"Aucune description"),1)]),c(" Paiements "),e.selectedAppointment.paiements&&e.selectedAppointment.paiements.length?(l(),r("div",qt,[o[12]||(o[12]=t("div",{class:"text-sm font-medium mb-2"},"Paiements",-1)),t("ul",Jt,[(l(!0),r(P,null,C(e.selectedAppointment.paiements,s=>(l(),r("li",{key:s.id},a(s.montant||s.amount||"0")+" € — "+a(s.mode||s.method||"—")+" — "+a(s.statut||s.status||""),1))),128))])])):c("v-if",!0),c(" Prescription "),e.selectedAppointment.prescription?(l(),r("div",Kt,[o[13]||(o[13]=t("div",{class:"text-sm font-medium mb-2"},"Prescription",-1)),t("div",Qt,a(e.selectedAppointment.prescription.notes||e.selectedAppointment.prescription.description||"Aucun détail"),1)])):c("v-if",!0)])):c("v-if",!0)])])):c("v-if",!0)])}const Zt=$(tt,[["render",Wt],["__scopeId","data-v-d674a325"],["__file","D:/sambatechpro/masanteplus-back/inertia/pages/dashboard/GererRendezVous.vue"]]);export{Zt as default};
