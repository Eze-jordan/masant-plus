import{c as r,m as l,e,j as N,v as T,H as Z,F as P,D as I,t as a,g as z,B as C,r as u,E as v,o as M,u as L,n as d}from"./app-BxLbybSS.js";import{_ as $}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ee={__name:"GererRendezVous",setup(V,{expose:o}){o();const A=u(""),t=u(!1),g=u([]),p=u(null),x=u(!1),f=u(""),_=[10,25,50],m=u(_[0]),s=u(1),D=new Date().toISOString().slice(0,10),E=n=>n.patient?`${n.patient.first_name||""} ${n.patient.last_name||""}`.trim()||"Nom inconnu":"â€”",R=n=>n.doctor?`${n.doctor.first_name||""} ${n.doctor.last_name||""}`.trim()||"Docteur inconnu":"â€”",F=n=>{var i,c;return n?`${((i=n.first_name)==null?void 0:i[0])||""}${((c=n.last_name)==null?void 0:c[0])||""}`.toUpperCase():"?"},O=n=>{const i="inline-block px-2 py-1 text-xs rounded";switch(n){case"ANNULE":return`${i} bg-red-100 text-red-700`;case"TERMINE":return`${i} bg-green-100 text-green-700`;case"CONFIRME":return`${i} bg-blue-100 text-blue-700`;default:return`${i} bg-gray-100 text-gray-700`}};async function h(){t.value=!0;try{const n=await fetch("/appointments");if(!n.ok)throw new Error(`Erreur HTTP: ${n.status}`);const i=await n.json();g.value=i.appointments||[]}catch(n){console.error("Erreur chargement rendez-vous",n),g.value=[]}finally{t.value=!1}}async function U(n){if(confirm("ÃŠtes-vous sÃ»r de vouloir annuler ce rendez-vous ?"))try{if(!(await fetch(`/appointments/cancel/${n}`,{method:"PUT"})).ok)throw new Error("Erreur lors de l'annulation");await h()}catch(i){console.error("Erreur annulation",i),alert("Erreur lors de l'annulation du rendez-vous")}}const y=v(()=>{let n=g.value;if(f.value&&(n=n.filter(c=>(c.dateDebut||"").toString().split("T")[0]===f.value)),!A.value)return n;const i=A.value.toLowerCase();return n.filter(c=>E(c).toLowerCase().includes(i)||R(c).toLowerCase().includes(i)||(c.dateDebut||"").toString().toLowerCase().includes(i)||(c.typeRdv||"").toLowerCase().includes(i))}),w=v(()=>Math.max(1,Math.ceil(y.value.length/m.value))),j=v(()=>{s.value>w.value&&(s.value=w.value);const n=(s.value-1)*m.value;return y.value.slice(n,n+m.value)}),B=v(()=>y.value.length===0?0:(s.value-1)*m.value+1),G=v(()=>Math.min(y.value.length,s.value*m.value)),q=v(()=>{const n=[],i=w.value,c=s.value;for(let k=Math.max(1,c-2);k<=Math.min(i,c+2);k++)n.push(k);return n}),H=()=>s.value--,Y=()=>s.value++,J=n=>s.value=n,K=n=>{if(!n)return"â€”";try{return new Date(n).toLocaleString("fr-FR",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}catch{return"Date invalide"}},Q=n=>{p.value=n,x.value=!0},W=()=>{p.value=null,x.value=!1};let b=null;async function X(){if(console.log("ðŸ”„ Refresh automatique des rendez-vousâ€¦"),await h(),p.value){const n=g.value.find(i=>i.id===p.value.id);n&&(p.value=n)}}M(()=>{h(),b=setInterval(()=>{console.log("ðŸ”„ Refresh automatiqueâ€¦"),h()},1e4)}),L(()=>{b&&clearInterval(b)});const S={search:A,loading:t,appointments:g,selectedAppointment:p,showDetails:x,selectedDate:f,pageSizes:_,pageSize:m,currentPage:s,maxDate:D,getPatientName:E,getDoctorName:R,getInitials:F,getStatusClass:O,fetchAppointments:h,cancelAppointment:U,filteredAppointments:y,totalPages:w,pagedAppointments:j,startItem:B,endItem:G,pagesToShow:q,prevPage:H,nextPage:Y,goToPage:J,formatDate:K,openDetails:Q,closeDetails:W,get refreshInterval(){return b},set refreshInterval(n){b=n},autoRefresh:X,ref:u,computed:v,onMounted:M,onUnmounted:L};return Object.defineProperty(S,"__isScriptSetup",{enumerable:!1,value:!0}),S}},te={class:"flex justify-between items-center mb-6"},se={class:"flex items-center gap-4"},ne=["max"],oe=["value"],ae={class:"bg-white shadow rounded overflow-x-auto"},ie={class:"min-w-full text-left"},le={key:0},re={key:1},de={class:"px-4 py-3 text-sm"},ce={class:"px-4 py-3 text-sm"},me={class:"px-4 py-3 text-sm"},ue={class:"px-4 py-3 text-sm"},pe={class:"px-4 py-3 text-sm"},ve={class:"px-4 py-3 text-sm"},ge={class:"px-4 py-3 text-sm"},xe=["onClick"],fe=["onClick"],_e={class:"mt-4 flex items-center justify-between"},he={class:"text-sm text-gray-600"},ye={class:"flex items-center gap-2"},be=["disabled"],Ae=["onClick"],De=["disabled"],we={key:0,class:"fixed inset-0 z-50 flex"},ke={class:"w-full max-w-md h-full bg-white shadow-2xl p-6 relative animate-slide-in-right overflow-y-auto"},Pe={key:0,class:"space-y-4"},Ie={class:"flex items-start gap-4"},Ne={class:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center text-2xl font-bold text-gray-500"},Ce={class:"flex-1"},Ee={class:"text-lg font-semibold"},Re={class:"text-sm text-gray-500"},Se={class:"text-sm text-gray-500"},Te={class:"grid grid-cols-2 gap-4"},ze={class:"p-3 bg-gray-50 rounded"},Me={class:"font-semibold"},Le={class:"text-sm text-gray-500"},Ve={class:"text-sm text-gray-500"},Fe={class:"p-3 bg-gray-50 rounded"},Oe={class:"mt-1 text-sm"},Ue={class:"text-sm"},je={class:"mt-1"},Be={class:"ml-2 inline-block px-2 py-1 text-xs rounded bg-gray-100 text-gray-700"},Ge={class:"p-3 bg-white rounded border"},qe={class:"text-sm text-gray-700"},He={key:0,class:"p-3 bg-white rounded border"},Ye={class:"text-sm text-gray-700 space-y-1"},Je={key:1,class:"p-3 bg-white rounded border"},Ke={class:"text-sm text-gray-700"};function Qe(V,o,A,t,g,p){var x,f,_,m;return d(),r("div",null,[l(" HEADER "),e("div",te,[o[3]||(o[3]=e("div",null,[e("h2",{class:"text-xl font-bold"},"Liste des rendez-vous"),e("p",{class:"text-sm text-gray-500"},"Tableau listant tous les rendez-vous")],-1)),e("div",se,[N(e("input",{"onUpdate:modelValue":o[0]||(o[0]=s=>t.search=s),type:"text",placeholder:"Rechercher par patient, mÃ©decin ou date",class:"px-4 py-2 border rounded-md w-80"},null,512),[[T,t.search]]),N(e("input",{"onUpdate:modelValue":o[1]||(o[1]=s=>t.selectedDate=s),type:"date",class:"px-3 py-2 border rounded-md",max:t.maxDate},null,8,ne),[[T,t.selectedDate]]),N(e("select",{"onUpdate:modelValue":o[2]||(o[2]=s=>t.pageSize=s),class:"px-3 py-2 border rounded-md"},[(d(),r(P,null,I(t.pageSizes,s=>e("option",{key:s,value:s},a(s)+" / page ",9,oe)),64))],512),[[Z,t.pageSize,void 0,{number:!0}]])])]),l(" TABLE "),e("div",ae,[e("table",ie,[o[6]||(o[6]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-4 py-2 text-sm font-medium"},"Date dÃ©but"),e("th",{class:"px-4 py-2 text-sm font-medium"},"Date fin"),e("th",{class:"px-4 py-2 text-sm font-medium"},"Patient"),e("th",{class:"px-4 py-2 text-sm font-medium"},"MÃ©decin"),e("th",{class:"px-4 py-2 text-sm font-medium"},"Type"),e("th",{class:"px-4 py-2 text-sm font-medium"},"Ã‰tat"),e("th",{class:"px-4 py-2 text-sm font-medium"},"Actions")])],-1)),e("tbody",null,[t.loading?(d(),r("tr",le,[...o[4]||(o[4]=[e("td",{colspan:"7",class:"px-4 py-6 text-center"},"Chargement...",-1)])])):!t.loading&&t.filteredAppointments.length===0?(d(),r("tr",re,[...o[5]||(o[5]=[e("td",{colspan:"7",class:"px-4 py-6 text-center"}," Aucun rendez-vous trouvÃ©. ",-1)])])):(d(!0),r(P,{key:2},I(t.pagedAppointments,s=>(d(),r("tr",{key:s.id,class:"border-t hover:bg-gray-50"},[e("td",de,a(t.formatDate(s.dateDebut)),1),e("td",ce,a(t.formatDate(s.dateFin)),1),e("td",me,a(t.getPatientName(s)),1),e("td",ue,a(t.getDoctorName(s)),1),e("td",pe,a(s.typeRdv),1),e("td",ve,[e("span",{class:C(t.getStatusClass(s.etatRdv))},a(s.etatRdv),3)]),e("td",ge,[e("button",{onClick:D=>t.openDetails(s),class:"text-blue-600 hover:underline mr-2"}," DÃ©tails ",8,xe),s.etatRdv!=="ANNULE"&&s.etatRdv!=="TERMINE"?(d(),r("button",{key:0,onClick:D=>t.cancelAppointment(s.id),class:"text-red-600 hover:underline"}," Annuler ",8,fe)):l("v-if",!0)])]))),128))])])]),l(" PAGINATION "),e("div",_e,[e("div",he," Affichage "+a(t.startItem)+" - "+a(t.endItem)+" sur "+a(t.filteredAppointments.length),1),e("div",ye,[e("button",{onClick:t.prevPage,disabled:t.currentPage===1,class:"px-3 py-1 bg-gray-100 rounded disabled:opacity-50"}," PrÃ©c ",8,be),(d(!0),r(P,null,I(t.pagesToShow,s=>(d(),r("button",{key:s,onClick:D=>t.goToPage(s),class:C(["px-3 py-1 rounded",s===t.currentPage?"bg-blue-600 text-white":"bg-gray-100"])},a(s),11,Ae))),128)),e("button",{onClick:t.nextPage,disabled:t.currentPage===t.totalPages,class:"px-3 py-1 bg-gray-100 rounded disabled:opacity-50"}," Suiv ",8,De)])]),l(" DETAILS PANEL "),t.showDetails?(d(),r("div",we,[e("div",{class:"flex-1 bg-black bg-opacity-40",onClick:t.closeDetails}),e("div",ke,[e("button",{class:"absolute top-3 right-3 text-gray-500 hover:bg-gray-100 rounded-full p-1",onClick:t.closeDetails}," Ã— "),o[14]||(o[14]=e("h3",{class:"text-xl font-semibold mb-4"}," DÃ©tails du rendez-vous ",-1)),t.selectedAppointment?(d(),r("div",Pe,[l(" PATIENT "),e("div",Ie,[e("div",Ne,a(t.getInitials(t.selectedAppointment.patient)),1),e("div",Ce,[e("div",Ee,a(t.getPatientName(t.selectedAppointment)),1),e("div",Re,a(((x=t.selectedAppointment.patient)==null?void 0:x.email)||"â€”"),1),e("div",Se,a(((f=t.selectedAppointment.patient)==null?void 0:f.phone)||"â€”"),1)])]),l(" INFORMATIONS "),e("div",Te,[l(" MÃ©decin "),e("div",ze,[o[7]||(o[7]=e("div",{class:"text-xs text-gray-500"},"MÃ©decin",-1)),e("div",Me,a(t.getDoctorName(t.selectedAppointment)),1),e("div",Le,a(((_=t.selectedAppointment.doctor)==null?void 0:_.email)||"â€”"),1),e("div",Ve,a(((m=t.selectedAppointment.doctor)==null?void 0:m.phone)||"â€”"),1)]),l(" Infos "),e("div",Fe,[o[10]||(o[10]=e("div",{class:"text-xs text-gray-500"},"Informations",-1)),e("div",Oe,[o[8]||(o[8]=e("span",{class:"font-medium"},"DÃ©but:",-1)),z(" "+a(t.formatDate(t.selectedAppointment.dateDebut)),1)]),e("div",Ue,[o[9]||(o[9]=e("span",{class:"font-medium"},"Fin:",-1)),z(" "+a(t.formatDate(t.selectedAppointment.dateFin)),1)]),e("div",je,[e("span",{class:C(t.getStatusClass(t.selectedAppointment.etatRdv))},a(t.selectedAppointment.etatRdv),3),e("span",Be,a(t.selectedAppointment.typeRdv),1)])])]),l(" DESCRIPTION "),e("div",Ge,[o[11]||(o[11]=e("div",{class:"text-sm font-medium mb-2"},"Description",-1)),e("div",qe,a(t.selectedAppointment.description||"Aucune description"),1)]),l(" PAYMENTS "),t.selectedAppointment.paiements&&t.selectedAppointment.paiements.length?(d(),r("div",He,[o[12]||(o[12]=e("div",{class:"text-sm font-medium mb-2"},"Paiements",-1)),e("ul",Ye,[(d(!0),r(P,null,I(t.selectedAppointment.paiements,s=>(d(),r("li",{key:s.id},a(s.montant||s.amount||"0")+" â‚¬ â€” "+a(s.mode||s.method||"â€”")+" â€” "+a(s.statut||s.status||""),1))),128))])])):l("v-if",!0),l(" PRESCRIPTION "),t.selectedAppointment.prescription?(d(),r("div",Je,[o[13]||(o[13]=e("div",{class:"text-sm font-medium mb-2"}," Prescription ",-1)),e("div",Ke,a(t.selectedAppointment.prescription.notes||t.selectedAppointment.prescription.description||"Aucun dÃ©tail"),1)])):l("v-if",!0)])):l("v-if",!0)])])):l("v-if",!0)])}const Ze=$(ee,[["render",Qe],["__scopeId","data-v-d674a325"],["__file","D:/sambatechpro/masanteplus-back/inertia/pages/dashboard/GererRendezVous.vue"]]);export{Ze as default};
